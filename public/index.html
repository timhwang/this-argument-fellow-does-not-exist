<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>This Argument Fellow Does Not Exist</title>
  <meta property="og:title" content="This Argument Fellow Does Not Exist">
  <meta property="og:description" content="Upload a photo. Receive your elite media destiny.">
  <meta property="og:image" content="https://timhwang.github.io/this-argument-fellow-does-not-exist/og-image.png">
  <meta property="og:url" content="https://timhwang.github.io/this-argument-fellow-does-not-exist/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="This Argument Fellow Does Not Exist">
  <meta name="twitter:description" content="Upload a photo. Receive your elite media destiny.">
  <meta name="twitter:image" content="https://timhwang.github.io/this-argument-fellow-does-not-exist/og-image.png">
  <link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #f3e7d6;
      color: #1a1a1a;
      font-family: 'Spectral', Georgia, serif;
      min-height: 100vh;
    }

    .header {
      background-color: #1a1a1a;
      padding: 16px 0;
      text-align: center;
    }

    .header-title {
      font-family: 'Inter', sans-serif;
      font-weight: 900;
      font-size: 14px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: #c5ff00;
    }

    .hero {
      text-align: center;
      padding: 60px 20px 40px;
      max-width: 720px;
      margin: 0 auto;
    }

    .hero h1 {
      font-family: 'Inter', sans-serif;
      font-weight: 900;
      font-size: 48px;
      line-height: 1.1;
      color: #1a1a1a;
      margin-bottom: 16px;
    }

    .hero h1 span {
      color: #8958ff;
    }

    .hero .subtitle {
      font-family: 'Spectral', serif;
      font-size: 20px;
      font-style: italic;
      color: #555;
      margin-bottom: 8px;
    }

    .hero .tagline {
      font-family: 'Inter', sans-serif;
      font-weight: 700;
      font-size: 14px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #8958ff;
      margin-top: 16px;
    }

    .upload-section {
      max-width: 600px;
      margin: 0 auto;
      padding: 0 20px 60px;
      text-align: center;
    }

    .drop-zone {
      border: 3px dashed #8958ff;
      border-radius: 12px;
      padding: 60px 40px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: rgba(137, 88, 255, 0.04);
      position: relative;
    }

    .drop-zone:hover {
      background: rgba(137, 88, 255, 0.1);
      border-color: #6b3fd4;
    }

    .drop-zone.drag-over {
      background: rgba(137, 88, 255, 0.15);
      border-color: #6b3fd4;
      transform: scale(1.01);
    }

    .drop-zone.has-image {
      padding: 20px;
      border-style: solid;
    }

    .drop-zone-text {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 18px;
      color: #8958ff;
      margin-bottom: 8px;
    }

    .drop-zone-subtext {
      font-family: 'Spectral', serif;
      font-size: 16px;
      color: #888;
      font-style: italic;
    }

    .drop-zone input[type="file"] {
      display: none;
    }

    .preview-image {
      max-width: 280px;
      max-height: 280px;
      border-radius: 8px;
      object-fit: cover;
      display: none;
      margin: 0 auto;
    }

    .generate-btn {
      font-family: 'Inter', sans-serif;
      font-weight: 700;
      font-size: 16px;
      letter-spacing: 1px;
      text-transform: uppercase;
      background: #8958ff;
      color: #fff;
      border: none;
      padding: 16px 48px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 30px;
      transition: all 0.2s ease;
      display: none;
    }

    .generate-btn:hover {
      background: #6b3fd4;
      transform: translateY(-1px);
    }

    .generate-btn:disabled {
      background: #b8a0e0;
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      display: none;
      margin-top: 40px;
      text-align: center;
    }

    .loading .spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(137, 88, 255, 0.2);
      border-top-color: #8958ff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      font-family: 'Spectral', serif;
      font-style: italic;
      font-size: 18px;
      color: #555;
      margin-top: 16px;
    }

    .result {
      display: none;
      max-width: 680px;
      margin: 0 auto 80px;
      padding: 0 20px;
    }

    .result-card {
      background: #fff;
      border-radius: 12px;
      padding: 48px;
      box-shadow: 0 2px 20px rgba(0,0,0,0.08);
    }

    .result-header {
      display: flex;
      gap: 32px;
      align-items: flex-start;
      margin-bottom: 28px;
    }

    .result-photo {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
      border: 4px solid #8958ff;
    }

    .result-intro {
      flex: 1;
    }

    .fellow-badge {
      font-family: 'Inter', sans-serif;
      font-weight: 700;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #fff;
      background: #8958ff;
      padding: 4px 12px;
      border-radius: 3px;
      display: inline-block;
      margin-bottom: 12px;
    }

    .result-name {
      font-family: 'Inter', sans-serif;
      font-weight: 800;
      font-size: 32px;
      color: #1a1a1a;
      line-height: 1.2;
      margin-bottom: 4px;
    }

    .result-beat {
      font-family: 'Spectral', serif;
      font-style: italic;
      font-size: 18px;
      color: #8958ff;
    }

    .result-bio {
      font-family: 'Spectral', serif;
      font-size: 18px;
      line-height: 1.7;
      color: #333;
    }

    .result-bio p {
      margin-bottom: 16px;
    }

    .result-bio p:last-child {
      margin-bottom: 0;
    }

    .result-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 32px;
      flex-wrap: wrap;
    }

    .share-btn {
      font-family: 'Inter', sans-serif;
      font-weight: 700;
      font-size: 14px;
      letter-spacing: 1px;
      text-transform: uppercase;
      background: #1a1a1a;
      color: #fff;
      border: none;
      padding: 12px 32px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .share-btn:hover {
      background: #333;
      transform: translateY(-1px);
    }

    .share-btn:disabled {
      background: #888;
      cursor: not-allowed;
      transform: none;
    }

    .try-again-btn {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 14px;
      background: none;
      border: 2px solid #8958ff;
      color: #8958ff;
      padding: 12px 32px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .try-again-btn:hover {
      background: #8958ff;
      color: #fff;
    }

    @media (max-width: 600px) {
      .hero h1 {
        font-size: 32px;
      }

      .result-header {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .result-card {
        padding: 32px 24px;
      }

      .result-name {
        font-size: 26px;
      }

      .result-actions {
        flex-direction: column;
        align-items: center;
      }

      .share-btn, .try-again-btn {
        width: 100%;
        max-width: 280px;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-title">The Argument</div>
  </div>

  <div class="hero">
    <h1>This <span>Argument Fellow</span> Does Not Exist</h1>
    <p class="subtitle">Upload a photo. Receive your elite media destiny.</p>
  </div>

  <div class="upload-section">
    <div class="drop-zone" id="dropZone">
      <p class="drop-zone-text" id="dropText">Drop your headshot here, or click to upload</p>
      <p class="drop-zone-subtext" id="dropSubtext">Preferably taken at a Brookings panel or rooftop in Adams Morgan</p>
      <input type="file" id="fileInput" accept="image/*">
      <img class="preview-image" id="previewImage">
    </div>
    <button class="generate-btn" id="generateBtn">Generate My Fellowship</button>
  </div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p class="loading-text">Consulting the algorithm (and three Ivy League admissions offices)...</p>
  </div>

  <div class="result" id="result">
    <div class="result-card">
      <div class="result-header">
        <img class="result-photo" id="resultPhoto">
        <div class="result-intro">
          <div class="fellow-badge">2026 Argument Fellow</div>
          <h2 class="result-name" id="resultName"></h2>
          <p class="result-beat" id="resultBeat"></p>
        </div>
      </div>
      <div class="result-bio" id="resultBio"></div>
    </div>
    <div class="result-actions">
      <button class="share-btn" id="shareBtn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        Save this Moment
      </button>
      <button class="try-again-btn" id="tryAgainBtn">Generate Another Fellow</button>
    </div>
  </div>


  <script>
    // API URL: uses local server in dev, Vercel function in production
    // UPDATE THIS after deploying your Vercel backend:
    const isLocal = ['localhost', '127.0.0.1'].includes(window.location.hostname);
    const API_URL = isLocal
      ? '/api/generate'
      : 'https://argument-fellow-api.vercel.app/api/generate';

    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const previewImage = document.getElementById('previewImage');
    const dropText = document.getElementById('dropText');
    const dropSubtext = document.getElementById('dropSubtext');
    const generateBtn = document.getElementById('generateBtn');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');
    const resultPhoto = document.getElementById('resultPhoto');
    const resultName = document.getElementById('resultName');
    const resultBeat = document.getElementById('resultBeat');
    const resultBio = document.getElementById('resultBio');
    const tryAgainBtn = document.getElementById('tryAgainBtn');
    const uploadSection = document.querySelector('.upload-section');

    let selectedFile = null;
    let base64Data = null;
    let mediaType = null;

    dropZone.addEventListener('click', () => fileInput.click());

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
      if (e.dataTransfer.files.length) {
        handleFile(e.dataTransfer.files[0]);
      }
    });

    fileInput.addEventListener('change', () => {
      if (fileInput.files.length) {
        handleFile(fileInput.files[0]);
      }
    });

    function handleFile(file) {
      if (!file.type.startsWith('image/')) return;
      selectedFile = file;
      mediaType = file.type;

      const reader = new FileReader();
      reader.onload = (e) => {
        const dataUrl = e.target.result;
        previewImage.src = dataUrl;
        previewImage.style.display = 'block';
        // Extract base64 portion from data URL
        base64Data = dataUrl.split(',')[1];
        dropText.textContent = 'Photo selected!';
        dropSubtext.textContent = 'Click to choose a different one';
        dropZone.classList.add('has-image');
        generateBtn.style.display = 'inline-block';
      };
      reader.readAsDataURL(file);
    }

    generateBtn.addEventListener('click', async () => {
      if (!base64Data) return;

      generateBtn.disabled = true;
      generateBtn.textContent = 'Generating...';
      loading.style.display = 'block';
      result.style.display = 'none';

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            image: base64Data,
            media_type: mediaType,
          }),
        });

        const data = await response.json();

        if (data.error) {
          alert('Error: ' + data.error);
          return;
        }

        await displayResult(data.bio);
      } catch (err) {
        alert('Something went wrong. Is the server running?');
        console.error(err);
      } finally {
        loading.style.display = 'none';
        generateBtn.disabled = false;
        generateBtn.textContent = 'Generate My Fellowship';
      }
    });

    function applyPurpleFilter(imgSrc) {
      return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext('2d');

          // Draw original image
          ctx.drawImage(img, 0, 0);

          // Get pixel data
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;

          // Purple duotone â€” bright, saturated, matching The Argument style
          // Dark end: medium purple (75, 35, 140)
          // Light end: very bright lavender (245, 230, 255)
          for (let i = 0; i < data.length; i += 4) {
            const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
            // Mild S-curve for contrast
            let t = gray / 255;
            t = t < 0.5
              ? 1.5 * t * t + 0.25 * t
              : 1 - (1.5 * (1 - t) * (1 - t) + 0.25 * (1 - t));
            data[i]     = Math.round(75 + t * (245 - 75));    // R
            data[i + 1] = Math.round(35 + t * (230 - 35));    // G
            data[i + 2] = Math.round(140 + t * (255 - 140));  // B
          }

          ctx.putImageData(imageData, 0, 0);
          resolve(canvas.toDataURL('image/png'));
        };
        img.src = imgSrc;
      });
    }

    async function displayResult(bioText) {
      const lines = bioText.split('\n').filter(l => l.trim());

      let name = '';
      let beat = '';
      let bioLines = [];

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!name && line.startsWith('**')) {
          name = line.replace(/\*\*/g, '');
        } else if (!beat && (line.startsWith('*(') || line.startsWith('*('))) {
          beat = line.replace(/\*/g, '').replace(/[()]/g, '');
        } else if (line.length > 0) {
          bioLines.push(line);
        }
      }

      // Apply purple duotone filter to the photo
      const filteredSrc = await applyPurpleFilter(previewImage.src);
      resultPhoto.src = filteredSrc;
      resultName.textContent = name || 'Fellow Name';
      resultBeat.textContent = beat || 'Policy & Discourse';
      resultBio.innerHTML = bioLines.map(p => {
        // Convert markdown *italic* and _italic_ to <em> tags
        let html = p.replace(/\*([^*]+)\*/g, '<em>$1</em>');
        html = html.replace(/(?<!\w)_([^_]+)_(?!\w)/g, '<em>$1</em>');
        return `<p>${html}</p>`;
      }).join('');

      uploadSection.style.display = 'none';
      result.style.display = 'block';
      result.scrollIntoView({ behavior: 'smooth' });
    }

    tryAgainBtn.addEventListener('click', () => {
      result.style.display = 'none';
      uploadSection.style.display = 'block';

      selectedFile = null;
      base64Data = null;
      mediaType = null;
      fileInput.value = '';
      previewImage.style.display = 'none';
      dropText.textContent = 'Drop your headshot here, or click to upload';
      dropSubtext.textContent = 'Preferably taken at a Brookings panel or rooftop in Adams Morgan';
      dropZone.classList.remove('has-image');
      generateBtn.style.display = 'none';
    });

    // ---- Share to X functionality ----

    const shareBtn = document.getElementById('shareBtn');
    const SHARE_BTN_HTML = shareBtn.innerHTML;

    async function ensureFontsLoaded() {
      await document.fonts.load('900 28px Inter');
      await document.fonts.load('800 36px Inter');
      await document.fonts.load('700 16px Inter');
      await document.fonts.load('italic 22px Spectral');
      await document.fonts.load('400 26px Spectral');
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight, maxLines, measureOnly) {
      const words = text.split(' ');
      let line = '';
      let lineCount = 0;

      for (let i = 0; i < words.length; i++) {
        const testLine = line + words[i] + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && line !== '') {
          lineCount++;
          if (lineCount >= maxLines) {
            if (!measureOnly) ctx.fillText(line.trim() + '...', x, y);
            return y;
          }
          if (!measureOnly) ctx.fillText(line.trim(), x, y);
          line = words[i] + ' ';
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      if (!measureOnly) ctx.fillText(line.trim(), x, y);
      return y;
    }

    function drawTextWithSpacing(ctx, text, x, y, spacing) {
      if ('letterSpacing' in ctx) {
        ctx.letterSpacing = spacing + 'px';
        ctx.fillText(text, x, y);
        ctx.letterSpacing = '0px';
      } else {
        let currentX = x;
        for (const char of text) {
          ctx.fillText(char, currentX, y);
          currentX += ctx.measureText(char).width + spacing;
        }
      }
    }

    function getFullBioText() {
      // Get full bio text from all paragraphs
      const paragraphs = resultBio.querySelectorAll('p');
      if (paragraphs.length === 0) return resultBio.textContent;
      return Array.from(paragraphs).map(p => p.textContent).join('\n\n');
    }

    function getSummaryBioText() {
      // First paragraph only for the share card
      const paragraphs = resultBio.querySelectorAll('p');
      if (paragraphs.length === 0) return resultBio.textContent;
      return paragraphs[0].textContent;
    }

    async function generateShareImage() {
      await ensureFontsLoaded();

      const S = 1080; // square
      const canvas = document.createElement('canvas');
      canvas.width = S;
      canvas.height = S;
      const ctx = canvas.getContext('2d');
      const pad = 60;
      const contentW = S - pad * 2;

      // === Dark banner at top ===
      const bannerH = 110;
      ctx.fillStyle = '#1a1a1a';
      ctx.fillRect(0, 0, S, bannerH);

      // Banner title - large lime text
      ctx.font = '900 28px Inter, Helvetica Neue, Arial, sans-serif';
      ctx.fillStyle = '#c5ff00';
      ctx.textAlign = 'center';
      drawTextWithSpacing(ctx, 'THIS ARGUMENT FELLOW DOES NOT EXIST', S / 2, 65, 4);
      ctx.textAlign = 'left';

      // === Beige body ===
      ctx.fillStyle = '#f3e7d6';
      ctx.fillRect(0, bannerH, S, S - bannerH);

      // === Photo + Name section (mirrors website layout) ===
      const sectionY = bannerH + 44;
      const photo = resultPhoto;
      const photoSize = 150;
      const photoX = pad;
      const photoY = sectionY;

      // Purple border circle
      ctx.beginPath();
      ctx.arc(photoX + photoSize / 2, photoY + photoSize / 2, photoSize / 2 + 4, 0, Math.PI * 2);
      ctx.fillStyle = '#8958ff';
      ctx.fill();

      // Clip and draw photo
      ctx.save();
      ctx.beginPath();
      ctx.arc(photoX + photoSize / 2, photoY + photoSize / 2, photoSize / 2, 0, Math.PI * 2);
      ctx.clip();
      ctx.drawImage(photo, photoX, photoY, photoSize, photoSize);
      ctx.restore();

      // === Text to the right of photo (badge, name, beat) ===
      const textX = photoX + photoSize + 28;
      const textMaxW = contentW - photoSize - 28;

      // Badge: "2026 ARGUMENT FELLOW" - bigger
      ctx.font = '700 16px Inter, Helvetica Neue, Arial, sans-serif';
      ctx.fillStyle = '#8958ff';
      drawTextWithSpacing(ctx, '2026 ARGUMENT FELLOW', textX, sectionY + 28, 2);

      // Name - large bold
      const name = resultName.textContent;
      ctx.font = '800 36px Inter, Helvetica Neue, Arial, sans-serif';
      ctx.fillStyle = '#1a1a1a';
      let nameSize = 36;
      while (ctx.measureText(name).width > textMaxW && nameSize > 20) {
        nameSize -= 2;
        ctx.font = `800 ${nameSize}px Inter, Helvetica Neue, Arial, sans-serif`;
      }
      ctx.fillText(name, textX, sectionY + 72);

      // Beat (italic, below name)
      ctx.font = 'italic 22px Spectral, Georgia, serif';
      ctx.fillStyle = '#8958ff';
      const beatText = resultBeat.textContent;
      // Wrap beat if too long
      if (ctx.measureText(beatText).width > textMaxW) {
        wrapText(ctx, beatText, textX, sectionY + 104, textMaxW, 28, 2);
      } else {
        ctx.fillText(beatText, textX, sectionY + 104);
      }

      // Thin purple divider below photo+name section
      const dividerY = sectionY + photoSize + 20;
      ctx.fillStyle = '#8958ff';
      ctx.fillRect(pad, dividerY, contentW, 2);

      // === Full bio text - left justified, vertically centered ===
      const bioLineHeight = 44;
      const bioParaGap = 50;
      ctx.font = '400 32px Spectral, Georgia, serif';
      const summaryBio = getSummaryBioText();

      // Measure pass: calculate total text height
      let measuredY = 0;
      measuredY = wrapText(ctx, summaryBio, pad, measuredY, contentW, bioLineHeight, 20, true);
      const totalTextH = measuredY;

      // Center between divider and bottom line
      const topEdge = dividerY + 2;
      const bottomEdge = S - pad;
      const availableH = bottomEdge - topEdge;
      const bioY = topEdge + (availableH - totalTextH) / 2;

      // Draw pass
      ctx.fillStyle = '#1a1a1a';
      ctx.textAlign = 'left';
      wrapText(ctx, summaryBio, pad, bioY, contentW, bioLineHeight, 20, false);

      // Bottom: thin purple line
      ctx.fillStyle = '#8958ff';
      ctx.fillRect(pad, S - pad, contentW, 2);

      return canvas;
    }

    function downloadImage(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    shareBtn.addEventListener('click', async () => {
      shareBtn.disabled = true;
      shareBtn.textContent = 'Saving...';

      try {
        const canvas = await generateShareImage();
        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
        downloadImage(blob, 'argument-fellow.png');
      } catch (err) {
        console.error('Share image generation failed:', err);
        alert('Failed to generate image. Please try again.');
      } finally {
        shareBtn.disabled = false;
        shareBtn.innerHTML = SHARE_BTN_HTML;
      }
    });
  </script>
</body>
</html>
